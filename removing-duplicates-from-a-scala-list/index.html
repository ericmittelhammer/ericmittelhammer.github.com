<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <link rel="stylesheet" href="/css/normalize.css">
        <link rel="stylesheet" href="/css/main.css">
        <link rel="stylesheet" href="/css/font-awesome.min.css">
        <link href='http://fonts.googleapis.com/css?family=Lato:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="http://softwaremaniacs.org/media/soft/highlight/styles/sunburst.css">
        <link rel="stylesheet" href="/css/site.css">
        <script src="http://softwaremaniacs.org/media/soft/highlight/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script src="/js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->
        <div id="main">
            <header id="global">
                <a href="/" id="blog-title">Eric Mittelhammer</a>
                <p class="about">Software guy doing software things.</p>
                <ul id="social">
                    <li><script type="text/javascript">
                    document.write("<a href=\"mail" + "to:" + new Array("blog","ericmittelhammer.com").join("@") + "\">" + "<i class=\"icon-envelope-alt\"></i>" + "</" + "a>");
                </script></li>
                <li><a href="http://twitter.com/emittelhammer"><i class="icon-twitter"></i></a></li>
                <li><a href="https://github.com/ericmittelhammer"><i class="icon-github"></i></a></li>
            </ul>
            </header>   
            <div class="content">
            <!-- Add your site or application content here -->
  <div id="post">
  	<div class="post-content">
	    <h1 class="post-title">Removing duplicates from a Scala List</h1>
	    <hr/>
	    <p><p>First things first - there are faster ways to dedupe a list than what I'm going to do here. So please resist the urge to nerd-rage on me about how "OMG THIS IS SO SLOW!"
</p>
<p>The fastest way would probably be to just turn it into a set:</p>
<pre><code class="scala">scala> List(3,3,3,3,2,2,2,2,6,6,6,6,9,9,9,9,9,5,5,5,5,4,4,4,4,4).toSet
res0: scala.collection.immutable.Set[Int] = Set(5, 6, 9, 2, 3, 4)</code></pre>

<p>But as you can see, the original ordering of the elements is not preserved.</p>
<p>In fact, immutable sets won't preserve their order as you append elements to them:</p>
<pre><code class="scala">scala> Set(1,2,3,4,5) + 6
res1: scala.collection.immutable.Set[Int] = Set(4, 5, 6, 1, 2, 3)</code></pre>

<p>So, you've got a list and you just need to dedupe it while preserving the original ordering of the elements.</p>
<p>Here's how:</p>
<pre><code class="scala">import scala.annotation.tailrec

def dedupe[T](elements: List[T], predicate: (T, T) => Boolean = (a: T, b: T) => { a == b }): List[T] = {
    @tailrec def recur(raw: List[T], deduped: List[T]): List[T] = 
        raw match {
            case Nil => deduped // no more raw elements to process, just return the final deduped list
            case head :: tail => recur(tail, 
                deduped.exists(predicate(_, head)) match {
                    case true => deduped  //element is in the list, just use the deduped list as-is
                    case false => head :: deduped //not in the list, so add it.
                })
        }
    // head/tail/cons are constant time operations but end up reversing the list.  undo that in a single operation before returning
    recur(elements, Nil).reverse 
}</code></pre>

<p>Inner defs, pattern matching, first-class funcitons.  Whoa Scala!</p>
<p>I'll break down what's going on here-
The method signature takes a list of <code>T</code>'s and a predicate function used to determine if two elements in the list are duplicate - an optional argument whose default value is function a that simply compares them with ==.  </p>
<p>Each iteration of the function determines if the head element exists in the accumuator. If not, it will cons (prepend) it and call itself, this time with the tail of the unprocessed list.  Since we're using the constant-time operations head/tail/cons, we must reverse the entire result before returning it.</p>
<p>See:
<pre><code class="scala">scala&gt; dedupe(List(3,3,3,3,2,2,2,2,6,6,6,6,9,9,9,9,9,5,5,5,5,4,4,4,4,4))
res10: List[Int] = List(3, 2, 6, 9, 5, 4)</code></pre>
Original order preserved!</p>
<p>And by using the "exists" method on the list instead of "contains", we can provide our own predicate:</p>
<pre><code class="scala">scala> case class Person(name: String, age:Int)
defined class Person

scala> val l = List(Person("Bob", 20), Person("Sue", 25), Person("Mary", 20), Person("Alice", 29))
l: List[Person] = List(Person(Bob,20), Person(Sue,25), Person(Mary,20), Person(Alice,29))

scala> dedupe(l, (a:Person, b:Person) => a.age == b.age)
res0: List[Person] = List(Person(Bob,20), Person(Sue,25), Person(Alice,29))</code></pre>

<p>We're deduping by age.  Since Bob was in the list first, he remains and Mary is gone.</p>
<p>Just beware that this function performs at <em>O(n<sup>2</sup>)</em> since every item could possibly be comapred against every other item in the list.</p></p>
	</div>
  </div>
            </div>
        </div>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.8.3.min.js"><\/script>')</script>
        <script src="/js/plugins.js"></script>
        <script src="/js/main.js"></script>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-25868864-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

        </script>
    </body>
</html>